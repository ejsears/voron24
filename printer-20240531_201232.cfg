[mcu]
#serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_1E003E001251313338343730-if00

canbus_uuid: 2d1866e6a738

[mcu EBBCan]
#canbus_uuid: b3346a43927e # SB2209
canbus_uuid: 2463a21d5f6a

[printer]
kinematics: corexy 
max_velocity: 800
max_accel: 15000 
max_z_velocity: 20
max_z_accel: 350
#square_corner_velocity: 5.0

[force_move]
enable_force_move: True

# S1
#[stepper_x]
#step_pin: PC14
#dir_pin: !PC13
#enable_pin: !PE6
#microsteps: 32
#rotation_distance: 40


# S2
[stepper_y]
step_pin: PE5
dir_pin: !PE4
enable_pin: !PE3
microsteps: 32
rotation_distance: 40
position_endstop: 350
position_min: -3
position_max: 352
homing_speed: 40
endstop_pin: PF2

# S3
[stepper_x]
step_pin: PE2
dir_pin: !PE1
enable_pin: !PE0
microsteps: 32
rotation_distance: 40
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_endstop: 350
position_min: 0
position_max: 350
homing_speed: 40
homing_retract_dist: 0

# S4
#[stepper_y1]
#step_pin: PB9
#dir_pin: !PB8
#enable_pin: !PB7
#microsteps: 32
#rotation_distance: 40

# S5
[stepper_z]
step_pin: PG9
dir_pin: !PG10
enable_pin: !PG13
microsteps: 32
rotation_distance: 40
gear_ratio: 80:16 
endstop_pin: probe:z_virtual_endstop 
position_max: 310
position_min: -5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0

#S6
[stepper_z1]
step_pin: PG11
dir_pin: PD7
enable_pin: !PG12
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

#S7
[stepper_z2]
step_pin: PB4
dir_pin: !PB3
enable_pin: !PB5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

#S8
[stepper_z3]
step_pin: PG15
dir_pin: PB6
enable_pin: !PG14
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

#[tmc5160 stepper_x]
#cs_pin: PD6
#run_current: 0.800
#sense_resistor: 0.022
#spi_software_sclk_pin: PC6
#spi_software_mosi_pin: PC8
#spi_software_miso_pin: PC7
#diag1_pin: ^!PC15
#driver_sgt: 1
#stealthchop_threshold: 999999

[tmc5160 stepper_x]
cs_pin: PD4
run_current: 1.4
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
#stealthchop_threshold: 999999
driver_sgt: 2
diag1_pin: ^!PF1
sense_resistor: 0.022

[tmc5160 stepper_y]
cs_pin: PD5
run_current: 1.4
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
#stealthchop_threshold: 999999
sense_resistor: 0.022

#[tmc5160 stepper_y1]
#cs_pin: PD3
#run_current: 1.4
#spi_software_sclk_pin: PC6
#spi_software_mosi_pin: PC8
#spi_software_miso_pin: PC7
#stealthchop_threshold: 0

[tmc5160 stepper_z]
cs_pin: PD2
run_current: 0.8
stealthchop_threshold: 999999
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7


[tmc5160 stepper_z1]
cs_pin: PA15
run_current: 0.8
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
stealthchop_threshold: 999999


[tmc5160 stepper_z2]
cs_pin: PA9
run_current: 0.8
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
stealthchop_threshold: 999999


[tmc5160 stepper_z3]
cs_pin: PA10
run_current: 0.8
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
stealthchop_threshold: 999999


##################################################################################
#  Extruder 
##################################################################################

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
#rotation_distance: 22.224930
#gear_ratio: 50:8
#microsteps: 32
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 4.637
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBBCan: PB13
max_extrude_only_distance: 500
max_extrude_only_velocity: 120

max_extrude_cross_section: 50
sensor_type: PT1000
sensor_pin: EBBCan: PA3
pullup_resistor: 2200
min_temp: 10
max_temp: 300 
max_power: 1.0
min_extrude_temp: 180 
pressure_advance_smooth_time: 0.040
#control: pid
#pid_kp: 35.172
#pid_ki: 1.184
#pid_kd: 261.158

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: True
run_current: 0.85
sense_resistor: 0.110
stealthchop_threshold: 0
driver_TBL: 0
driver_HEND: 6
driver_HSTRT: 7
driver_TOFF: 4

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_938FB47D5154354D38202020FF0A2E3E-if00 
x_offset: 0
y_offset: 32
mesh_main_direction: x
mesh_runs: 2
z_settling_time: 1000

[heater_bed]
heater_pin: PF5
sensor_pin: PB0
sensor_type: ATC Semitec 104NT-4-R025H42G
min_temp: 10
max_temp: 130
max_power: 0.8
#control: pid
#pid_kp: 48.902
#pid_ki: 1.598
#pid_kd: 374.099

[idle_timeout]
timeout: 1800

[quad_gantry_level]
gantry_corners:
        -60,-10
        410,420
points:
        50,25
        50,275
        300,275
        300,25
speed: 200
horizontal_move_z: 5
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

# Print Cooling Fan
[fan]
pin: EBBCan: PA0
kick_start_time: 0.8
off_below: 0.10
#speed: 0.6

[heater_fan nevermore]
pin: PA2
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0
heater: heater_bed
heater_temp: 65
fan_speed: 0.5

[controller_fan controller_fan]
pin: PA0
kick_start_time: 0.5
heater: heater_bed
stepper: stepper_x, stepper_y, stepper_z
max_power: 0.90
off_below: 0.10
fan_speed: 0.3
idle_speed: 0.2

[safe_z_home]
home_xy_position = 175,175
speed = 100
z_hop = 3

##################################################################################
#  Lighting 
##################################################################################
[output_pin caselight]
## Chamber Lighting
pin: PA3
pwm: true
shutdown_value: 0
value: 0
cycle_time: 0.01

[heater_fan hotend_fan]
pin: EBBCan: PA1
kick_start_time: 0.8
heater: extruder
heater_temp: 50
off_below: 0.10
fan_speed: 0.6

#[heater_fan hotend_fan]
#pin: EBBCan:PA1
#shutdown_speed: 0.0
#kick_start_time: 0.5
#heater: extruder
#heater_temp: 50.0
#fan_speed: 0.5 

#[heater_fan fan2]
#pin: PA2

#[fan_generic fan3]
#pin: PA3

#[fan_generic fan4]
#pin: PA4

#[fan_generic fan5]
#pin: PA5

#[fan_generic fan6]
#pin: PA6
#tachometer_pin: PC1

#[fan_generic fan7]
#pin: PE8
#tachometer_pin: PG0

##################################################################################
#  Display Stuff 
##################################################################################
[board_pins]
aliases:
    # FPC header, Aliases EXP1 & EXP2 for mini12864
    EXP1_1=PG5, EXP1_2=PG4,
    EXP1_3=PG3, EXP1_4=PG2,
    EXP1_5=PD15, EXP1_6=PD14,
    EXP1_7=PD13, EXP1_8=PD12,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PE13, EXP2_2=PE12,
    EXP2_3=PG8, EXP2_4=PE11,
    EXP2_5=PG7, EXP2_6=PE14,
    EXP2_7=PG6, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<NC>


#[bltouch]
#sensor_pin: ^PG1
#control_pin: PE9

# Proximity switch
#[probe]
#pin: PD11

#[output_pin ps_on_pin]
#pin: PD10

#[neopixel my_neopixel_1]
#pin: PF12

#[neopixel my_neopixel_2]
#pin: PF11

#[hall_filament_width_sensor]
#adc1: PC2
#adc2: PC3

#[adxl345]
#cs_pin: PE10
#spi_bus: spi4

#[servo servo_motor]
#pin: PE7

#i2c_bus:i2c2_PB10_PB11

##################################################################################
#  Custom Stuff
##################################################################################

[virtual_sdcard]
path: ~/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[firmware_retraction]
retract_length: 0.8
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 10

[exclude_object]
[gcode_arcs]
resolution: 0.1

[include mainsail.cfg]
[include hardware/*.cfg]
[include macros/*.cfg]
[include K-ShakeTune/*.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.4183233935815625,
#*# 	  1.7446261125071758,
#*# 	  0.7680045168791478,
#*# 	  0.3772023187749047,
#*# 	  0.29869218561232636,
#*# 	  0.23573587347383934,
#*# 	  -0.1085772191091354,
#*# 	  -0.07756468886087663,
#*# 	  0.22311755660879987,
#*# 	  0.12099037581538158
#*# model_domain = 1.8031832762152393e-07,1.928894919989729e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 73.268153
#*# model_offset = 0.10000
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.838
#*# pid_ki = 1.597
#*# pid_kd = 67.984
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.023558, -0.014703, -0.004326, 0.009951, 0.016677, 0.030522, 0.044755, 0.048857, 0.038929, 0.024220, 0.011397, 0.010024, 0.011286, 0.005499, 0.007436
#*# 	  -0.021180, -0.017960, -0.012603, -0.003399, 0.005833, 0.018336, 0.029950, 0.029157, 0.021142, 0.005798, -0.005868, -0.007856, -0.007335, -0.013038, -0.011591
#*# 	  -0.001987, -0.007294, -0.014240, -0.008536, 0.001181, 0.011434, 0.018745, 0.015184, 0.005480, -0.008814, -0.020400, -0.023115, -0.021914, -0.021983, -0.024633
#*# 	  -0.004629, -0.010805, -0.015432, -0.008465, 0.001635, 0.010888, 0.016721, 0.012843, 0.002878, -0.006124, -0.015426, -0.020557, -0.024282, -0.025199, -0.026722
#*# 	  -0.027345, -0.026530, -0.020316, -0.009268, 0.001717, 0.011029, 0.018746, 0.011634, 0.000017, -0.008565, -0.003269, -0.008260, -0.026940, -0.035296, -0.033652
#*# 	  -0.048139, -0.041766, -0.029487, -0.015397, -0.004897, 0.005387, 0.010093, 0.005430, -0.010210, -0.019840, -0.014819, -0.018503, -0.037759, -0.047387, -0.040365
#*# 	  -0.051717, -0.043371, -0.028838, -0.014321, -0.006533, 0.002202, 0.007267, 0.000456, -0.015272, -0.029862, -0.037087, -0.044292, -0.052234, -0.055576, -0.046987
#*# 	  -0.054483, -0.044554, -0.027363, -0.013743, -0.006434, 0.000575, 0.003428, 0.000000, -0.016261, -0.033710, -0.043992, -0.052592, -0.055309, -0.055796, -0.049394
#*# 	  -0.049102, -0.044374, -0.025447, -0.011166, -0.003382, 0.003138, 0.006262, -0.001774, -0.013435, -0.031090, -0.043070, -0.049533, -0.051590, -0.050650, -0.044093
#*# 	  -0.040176, -0.036007, -0.022047, -0.007025, 0.001479, 0.007112, 0.012228, 0.005893, -0.003536, -0.023069, -0.039589, -0.043587, -0.042693, -0.040840, -0.033216
#*# 	  -0.030575, -0.029763, -0.016961, -0.006555, 0.000944, 0.004901, 0.011271, 0.008691, -0.000470, -0.020670, -0.040249, -0.043800, -0.038404, -0.037187, -0.031350
#*# 	  -0.028812, -0.027896, -0.015160, -0.006076, -0.001752, 0.002275, 0.008057, 0.005450, -0.001582, -0.020217, -0.037676, -0.040331, -0.033589, -0.033753, -0.026507
#*# 	  -0.023821, -0.023319, -0.013121, -0.005537, -0.002749, 0.002377, 0.007721, 0.004210, -0.001854, -0.017009, -0.031825, -0.035132, -0.030397, -0.029219, -0.021570
#*# 	  -0.020060, -0.021404, -0.012882, -0.005707, -0.005454, -0.002014, 0.002637, 0.000787, -0.003000, -0.015876, -0.030390, -0.035906, -0.029616, -0.025517, -0.014804
#*# 	  -0.014123, -0.016459, -0.007050, 0.000272, -0.002394, -0.001681, 0.001309, 0.000229, -0.002245, -0.014302, -0.029459, -0.035236, -0.026473, -0.016650, -0.001963
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 40.0
#*# max_x = 310.0
#*# min_y = 40.0
#*# max_y = 310.0
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 48.474
#*# pid_ki = 1.539
#*# pid_kd = 381.736
