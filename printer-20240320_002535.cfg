[mcu]
#serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_1E003E001251313338343730-if00
canbus_uuid: 2d1866e6a738

[mcu EBBCan]
#canbus_uuid: b3346a43927e # SB2209
canbus_uuid: 2463a21d5f6a

[printer]
kinematics: corexy 
max_velocity: 300
max_accel: 9700
max_z_velocity: 20
max_z_accel: 350
square_corner_velocity: 5.0

# S1
[stepper_x]
step_pin: PC14
dir_pin: PC13
enable_pin: !PE6
microsteps: 32
rotation_distance: 40
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_endstop: 0
position_max: 350
homing_speed: 40
homing_retract_dist: 0

# S2
[stepper_y]
step_pin: PE5
dir_pin: PE4
enable_pin: !PE3
microsteps: 32
rotation_distance: 40
position_endstop: 0
position_max: 350
homing_speed: 40
endstop_pin: PF1

# S3
[stepper_x1]
step_pin: PE2
dir_pin: PE1
enable_pin: !PE0
microsteps: 32
rotation_distance: 40

# S4
[stepper_y1]
step_pin: PB9
dir_pin: PB8
enable_pin: !PB7
microsteps: 32
rotation_distance: 40

# S5
[stepper_z]
step_pin: PG9
dir_pin: !PG10
enable_pin: !PG13
microsteps: 32
rotation_distance: 40
gear_ratio: 80:16 
endstop_pin: probe:z_virtual_endstop 
position_max: 310
position_min: -5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0

#S6
[stepper_z1]
step_pin: PG11
dir_pin: PD7
enable_pin: !PG12
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

#S7
[stepper_z2]
step_pin: PB4
dir_pin: !PB3
enable_pin: !PB5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

#S8
[stepper_z3]
step_pin: PG15
dir_pin: PB6
enable_pin: !PG14
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc5160 stepper_x]
cs_pin: PD6
run_current: 1.4
sense_resistor: 0.022
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7
diag1_pin: ^!PC15
driver_sgt: 1

[tmc5160 stepper_x1]
cs_pin: PD4
run_current: 1.4
sense_resistor: 0.022
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7

[tmc5160 stepper_y]
cs_pin: PD5
run_current: 1.4
sense_resistor: 0.022
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7

[tmc5160 stepper_y1]
cs_pin: PD3
run_current: 1.4
sense_resistor: 0.022
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7

[tmc5160 stepper_z]
cs_pin: PD2
run_current: 0.8
sense_resistor: 0.022
stealthchop_threshold: 999999
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7

[tmc5160 stepper_z1]
cs_pin: PA15
run_current: 0.8
sense_resistor: 0.022
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7

[tmc5160 stepper_z2]
cs_pin: PA9
run_current: 0.8
sense_resistor: 0.022
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7

[tmc5160 stepper_z3]
cs_pin: PA10
run_current: 0.8
sense_resistor: 0.022
spi_software_sclk_pin: PC6
spi_software_mosi_pin: PC8
spi_software_miso_pin: PC7

##################################################################################
#  Extruder 
##################################################################################

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
rotation_distance: 22.224930
gear_ratio: 50:8
microsteps: 32
full_steps_per_rotation: 200

nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBBCan: PB13
max_extrude_only_distance: 200
max_extrude_cross_section: 50
sensor_type: PT1000
sensor_pin: EBBCan: PA3
pullup_resistor: 2200
min_temp: 10
max_temp: 300 
max_power: 1.0
min_extrude_temp: 200
pressure_advance_smooth_time: 0.040
control: pid
pid_kp: 35.172
pid_ki: 1.184
pid_kd: 261.158

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: True
run_current: 0.5
sense_resistor: 0.110
stealthchop_threshold: 0

[beacon]
serial = /dev/serial/by-id/usb-Beacon_Beacon_RevH_79E6B4405154364134202020FF15201C-if00
x_offset = 0
y_offset = 27
mesh_main_direction = x
mesh_runs = 2
z_settling_time = 1000

[heater_bed]
heater_pin = PF5
sensor_pin = PB0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 10
max_temp = 130
max_power = 0.8
control = pid
pid_kp = 48.902
pid_ki = 1.598
pid_kd = 374.099

[idle_timeout]
timeout = 1800

[quad_gantry_level]
gantry_corners =
        -60,-10
        410,420
points =
        50,25
        50,275
        300,275
        300,25
speed = 200
horizontal_move_z = 5
retries = 5
retry_tolerance = 0.0075
max_adjust = 10

[fan]
pin = EBBCan: PA0

[heater_fan nevermore]
pin = PA2
max_power = 1.0
shutdown_speed = 0.0
kick_start_time = 5.0
heater = heater_bed
heater_temp = 65
fan_speed = 0.5

[controller_fan controller_fan]
pin = PA0
kick_start_time = 0.5
heater = heater_bed
stepper = stepper_x, stepper_y, stepper_z
max_power = 0.90
off_below = 0.10
fan_speed = 0.3
idle_speed = 0.2

#[safe_z_home]
#home_xy_position = 175,175
#speed = 100
#z_hop = 3

##################################################################################
#  Lighting 
##################################################################################
[output_pin caselight]
## Chamber Lighting
pin: PA3
pwm: true
shutdown_value: 0
value: 0
cycle_time: 0.01


[heater_fan fan1]
pin: EBBCan: PA1

#[heater_fan fan2]
#pin: PA2

#[fan_generic fan3]
#pin: PA3

#[fan_generic fan4]
#pin: PA4

#[fan_generic fan5]
#pin: PA5

#[fan_generic fan6]
#pin: PA6
#tachometer_pin: PC1

#[fan_generic fan7]
#pin: PE8
#tachometer_pin: PG0

##################################################################################
#  Display Stuff 
##################################################################################
[board_pins]
aliases:
    # FPC header, Aliases EXP1 & EXP2 for mini12864
    EXP1_1=PG5, EXP1_2=PG4,
    EXP1_3=PG3, EXP1_4=PG2,
    EXP1_5=PD15, EXP1_6=PD14,
    EXP1_7=PD13, EXP1_8=PD12,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PE13, EXP2_2=PE12,
    EXP2_3=PG8, EXP2_4=PE11,
    EXP2_5=PG7, EXP2_6=PE14,
    EXP2_7=PG6, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<NC>


#[bltouch]
#sensor_pin: ^PG1
#control_pin: PE9

# Proximity switch
#[probe]
#pin: PD11

#[output_pin ps_on_pin]
#pin: PD10

#[neopixel my_neopixel_1]
#pin: PF12

#[neopixel my_neopixel_2]
#pin: PF11

#[hall_filament_width_sensor]
#adc1: PC2
#adc2: PC3

#[adxl345]
#cs_pin: PE10
#spi_bus: spi4

#[servo servo_motor]
#pin: PE7

#i2c_bus:i2c2_PB10_PB11

##################################################################################
#  Custom Stuff
##################################################################################

[virtual_sdcard]
path: ~/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[firmware_retraction]
retract_length: 0.8
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 10

[exclude_object]
[gcode_arcs]
resolution: 0.1

[include mainsail.cfg]
[include hardware/*.cfg]
[include macros/*.cfg]
